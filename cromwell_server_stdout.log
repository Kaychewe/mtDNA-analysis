
[1;33mjava 17.0.8-tem is already installed.[0m

[1;32mUsing java version 17.0.8-tem in this shell.[0m
Validating WDL...
Success!
2026-02-04 19:37:05 main INFO  - Running with database db.url = jdbc:hsqldb:file:local_cromwell_run.db;shutdown=false;hsqldb.default_table_type=cached;hsqldb.tx=mvcc;hsqldb.large_data=true;hsqldb.lob_compressed=true;hsqldb.script_format=3;hsqldb.result_max_memory_rows=20000
2026-02-04 19:37:06 db connection adder INFO  - dataFileCache open start
2026-02-04 19:37:06 db connection adder INFO  - dataFileCache open end
2026-02-04 19:37:06 db connection adder INFO  - checkpointClose start
2026-02-04 19:37:06 db connection adder INFO  - checkpointClose synched
2026-02-04 19:37:06 db connection adder INFO  - checkpointClose script done
2026-02-04 19:37:06 db connection adder INFO  - dataFileCache commit start
2026-02-04 19:37:06 db connection adder INFO  - dataFileCache commit end
2026-02-04 19:37:06 db connection adder INFO  - checkpointClose end
2026-02-04 19:37:07 db-1 INFO  - Checkpoint start
2026-02-04 19:37:07 db-1 INFO  - checkpointClose start
2026-02-04 19:37:07 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:07 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:07 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:07 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:07 db-1 INFO  - checkpointClose end
2026-02-04 19:37:07 db-1 INFO  - Checkpoint end - txts: 24534
2026-02-04 19:37:07 db-1 INFO  - Checkpoint start
2026-02-04 19:37:07 db-1 INFO  - checkpointClose start
2026-02-04 19:37:07 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:07 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:07 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:07 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:07 db-1 INFO  - checkpointClose end
2026-02-04 19:37:07 db-1 INFO  - Checkpoint end - txts: 24604
2026-02-04 19:37:07 db-1 INFO  - Checkpoint start
2026-02-04 19:37:07 db-1 INFO  - checkpointClose start
2026-02-04 19:37:07 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:07 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:07 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:07 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:07 db-1 INFO  - checkpointClose end
2026-02-04 19:37:07 db-1 INFO  - Checkpoint end - txts: 24606
2026-02-04 19:37:09 db-1 INFO  - Checkpoint start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:09 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:09 db-1 INFO  - checkpointClose end
2026-02-04 19:37:09 db-1 INFO  - Checkpoint end - txts: 24661
2026-02-04 19:37:09 db-1 INFO  - Checkpoint start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:09 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:09 db-1 INFO  - checkpointClose end
2026-02-04 19:37:09 db-1 INFO  - Checkpoint end - txts: 24724
2026-02-04 19:37:09 db-1 INFO  - Checkpoint start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:09 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:09 db-1 INFO  - checkpointClose end
2026-02-04 19:37:09 db-1 INFO  - Checkpoint end - txts: 24726
2026-02-04 19:37:09 db-1 INFO  - Checkpoint start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:09 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:09 db-1 INFO  - checkpointClose end
2026-02-04 19:37:09 db-1 INFO  - Checkpoint end - txts: 24733
2026-02-04 19:37:09 db-1 INFO  - Checkpoint start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:09 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:09 db-1 INFO  - checkpointClose end
2026-02-04 19:37:09 db-1 INFO  - Checkpoint end - txts: 24735
2026-02-04 19:37:09 db-1 INFO  - Checkpoint start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:09 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:09 db-1 INFO  - checkpointClose end
2026-02-04 19:37:09 db-1 INFO  - Checkpoint end - txts: 24737
2026-02-04 19:37:09 main INFO  - Running with database db.url = jdbc:hsqldb:file:local_cromwell_run.db;shutdown=false;hsqldb.default_table_type=cached;hsqldb.tx=mvcc;hsqldb.large_data=true;hsqldb.lob_compressed=true;hsqldb.script_format=3;hsqldb.result_max_memory_rows=20000
2026-02-04 19:37:09 db-1 INFO  - Checkpoint start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose start
2026-02-04 19:37:09 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:09 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:09 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:09 db-1 INFO  - checkpointClose end
2026-02-04 19:37:09 db-1 INFO  - Checkpoint end - txts: 24745
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24815
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24817
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24872
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24935
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24937
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24944
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24946
2026-02-04 19:37:10 db-1 INFO  - Checkpoint start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose start
2026-02-04 19:37:10 db-1 INFO  - checkpointClose synched
2026-02-04 19:37:10 db-1 INFO  - checkpointClose script done
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit start
2026-02-04 19:37:10 db-1 INFO  - dataFileCache commit end
2026-02-04 19:37:10 db-1 INFO  - checkpointClose end
2026-02-04 19:37:10 db-1 INFO  - Checkpoint end - txts: 24948
2026-02-04 19:37:11 main INFO  - Reference disks feature for batchConfig backend is not configured.
2026-02-04 19:37:11 cromwell-system-akka.actor.default-dispatcher-5 INFO  - Slf4jLogger started
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.engine-dispatcher-7 INFO  - Workflow heartbeat configuration:
{
  "cromwellId" : "cromid-9a63f7e",
  "heartbeatInterval" : "2 minutes",
  "ttl" : "10 minutes",
  "failureShutdownDuration" : "5 minutes",
  "writeBatchSize" : 10000,
  "writeThreshold" : 10000
}
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.service-dispatcher-14 INFO  - Metadata summary refreshing every 1 second.
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.service-dispatcher-14 INFO  - No metadata archiver defined in config
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.service-dispatcher-14 INFO  - No metadata deleter defined in config
2026-02-04 19:37:11 cromwell-system-akka.actor.default-dispatcher-6 INFO  - KvWriteActor configured to flush with batch size 200 and process rate 5 seconds.
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.service-dispatcher-9 INFO  - WriteMetadataActor configured to flush with batch size 200 and process rate 5 seconds.
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.engine-dispatcher-29 INFO  - JobStoreWriterActor configured to flush with batch size 1000 and process rate 1 second.
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.engine-dispatcher-34 INFO  - CallCacheWriteActor configured to flush with batch size 100 and process rate 3 seconds.
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.engine-dispatcher-36 INFO  - JobRestartCheckTokenDispenser - Distribution rate: 50 per 1 seconds.
2026-02-04 19:37:11 cromwell-system-akka.dispatchers.engine-dispatcher-36 INFO  - JobExecutionTokenDispenser - Distribution rate: 50 per 3 seconds.
2026-02-04 19:37:12 cromwell-system-akka.dispatchers.engine-dispatcher-36 INFO  - GroupMetricsActor configured to log groups experiencing quota exhaustion at interval of 5 minutes.
2026-02-04 19:37:12 cromwell-system-akka.dispatchers.backend-dispatcher-39 INFO  - Running with 3 Batch request workers
2026-02-04 19:37:12 cromwell-system-akka.dispatchers.backend-dispatcher-39 INFO  - 'resetAllWorkers()' called to fill vector with 3 new workers
2026-02-04 19:37:12 cromwell-system-akka.dispatchers.backend-dispatcher-39 INFO  - Request manager BatchApiRequestManager created new Batch request worker BatchQueryWorker-975f60d7-ddc5-4e88-ba2d-2d36905ee9c4 with batch interval of 3333 milliseconds
2026-02-04 19:37:12 cromwell-system-akka.dispatchers.backend-dispatcher-39 INFO  - Request manager BatchApiRequestManager created new Batch request worker BatchQueryWorker-33ca3db1-4170-4361-927d-3339326ccd2d with batch interval of 3333 milliseconds
2026-02-04 19:37:12 cromwell-system-akka.dispatchers.backend-dispatcher-39 INFO  - Request manager BatchApiRequestManager created new Batch request worker BatchQueryWorker-2689a1a1-f2bb-4587-9f52-61f57ab45b47 with batch interval of 3333 milliseconds
2026-02-04 19:37:13 cromwell-system-akka.actor.default-dispatcher-5 ERROR - Bind failed for TCP channel on endpoint [/0.0.0.0:8094]
java.net.BindException: Address already in use
	at java.base/sun.nio.ch.Net.bind0(Native Method)
	at java.base/sun.nio.ch.Net.bind(Net.java:555)
	at java.base/sun.nio.ch.ServerSocketChannelImpl.netBind(ServerSocketChannelImpl.java:337)
	at java.base/sun.nio.ch.ServerSocketChannelImpl.bind(ServerSocketChannelImpl.java:294)
	at java.base/sun.nio.ch.ServerSocketAdaptor.bind(ServerSocketAdaptor.java:89)
	at akka.io.TcpListener.liftedTree1$1(TcpListener.scala:59)
	at akka.io.TcpListener.<init>(TcpListener.scala:56)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:499)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:480)
	at akka.util.Reflect$.instantiate(Reflect.scala:68)
	at akka.actor.ArgsReflectConstructor.produce(IndirectActorProducer.scala:101)
	at akka.actor.Props.newActor(Props.scala:212)
	at akka.actor.ActorCell.newActor(ActorCell.scala:650)
	at akka.actor.ActorCell.create(ActorCell.scala:676)
	at akka.actor.ActorCell.invokeAll$1(ActorCell.scala:549)
	at akka.actor.ActorCell.systemInvoke(ActorCell.scala:571)
	at akka.dispatch.Mailbox.processAllSystemMessages(Mailbox.scala:293)
	at akka.dispatch.Mailbox.run(Mailbox.scala:228)
	at akka.dispatch.Mailbox.exec(Mailbox.scala:241)
	at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
	at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       2026-02-04 19:44:03 cromwell-system-akka.dispatchers.api-dispatcher-110 INFO  - Workflows b91103f9-dfd9-4179-aa3d-eadc298ca0c9 submitted.
2026-02-04 19:44:04 cromwell-system-akka.dispatchers.engine-dispatcher-43 INFO  - 1 new workflows fetched by cromid-552f205: b91103f9-dfd9-4179-aa3d-eadc298ca0c9
2026-02-04 19:44:04 cromwell-system-akka.dispatchers.engine-dispatcher-43 INFO  - WorkflowManagerActor: Starting workflow UUID(b91103f9-dfd9-4179-aa3d-eadc298ca0c9)
2026-02-04 19:44:04 cromwell-system-akka.dispatchers.engine-dispatcher-43 INFO  - WorkflowManagerActor: Successfully started WorkflowActor-b91103f9-dfd9-4179-aa3d-eadc298ca0c9
2026-02-04 19:44:04 cromwell-system-akka.dispatchers.engine-dispatcher-43 INFO  - Retrieved 1 workflows from the WorkflowStoreActor
2026-02-04 19:44:04 cromwell-system-akka.dispatchers.engine-dispatcher-42 INFO  - MaterializeWorkflowDescriptorActor [UUID(b91103f9)]: Parsing workflow as WDL 1.0
2026-02-04 19:44:07 cromwell-system-akka.dispatchers.engine-dispatcher-42 INFO  - MaterializeWorkflowDescriptorActor [UUID(b91103f9)]: Call-to-Backend assignments: MitochondriaPipelineWrapper.MergeMitoMultiSampleOutputsInternal -> GCPBATCH, AlignAndCallR1.GetContamination -> GCPBATCH, MitochondriaPipeline.LiftoverSelfCoverage -> GCPBATCH, ProduceSelfReferenceFiles.ChainSwapLiftoverBed -> GCPBATCH, MitochondriaPipeline.SubsetBamToChrMAndRevert -> GCPBATCH, ProduceSelfReferenceFiles.ProduceSelfReference -> GCPBATCH, ProduceSelfReferenceFiles.SelfToRefNucLiftoverChain -> GCPBATCH, AlignAndCallR1.FilterContamination -> GCPBATCH, AlignAndCallR2.LiftoverCombineMergeFilterContamSplit -> GCPBATCH, AlignAndCallR2.CallMtAndShifted -> GCPBATCH, MitochondriaPipeline.LiftOverAfterSelf -> GCPBATCH, AlignAndCallR1.CallMt -> GCPBATCH, ProduceSelfReferenceFiles.LiftOverNucReferenceShifted -> GCPBATCH, ProduceSelfReferenceFiles.LiftOverNucReference -> GCPBATCH, AlignAndCallR2.AlignToMtRegShiftedAndMetrics -> GCPBATCH, MitochondriaPipeline.LiftOverAndJoinCoverage -> GCPBATCH, AlignAndCallR1.CallNucM2Integrated -> GCPBATCH, AlignAndCallR1.CallNucHCIntegrated -> GCPBATCH, MitochondriaPipeline.NucCoverageAtEveryBase -> GCPBATCH, ProduceSelfReferenceFiles.MoveChainToZero -> GCPBATCH
2026-02-04 19:44:12 cromwell-system-akka.dispatchers.engine-dispatcher-36 INFO  - b91103f9-dfd9-4179-aa3d-eadc298ca0c9-SubWorkflowExecutionActor-SubWorkflow-MitochondriaPipeline_v2_5:0:1 [UUID(b91103f9)SubWorkflow-MitochondriaPipeline_v2_5:0:1]: Running subworkflow: e855d8bc-1aff-4b7a-b066-ceb54d032499, root: b91103f9-dfd9-4179-aa3d-eadc298ca0c9
2026-02-04 19:44:14 cromwell-system-akka.dispatchers.engine-dispatcher-8 INFO  - e855d8bc-1aff-4b7a-b066-ceb54d032499-SubWorkflowActor-SubWorkflow-MitochondriaPipeline_v2_5:0:1 [UUID(e855d8bc)]: Starting MitochondriaPipeline.SubsetBamToChrMAndRevert
2026-02-04 19:44:15 cromwell-system-akka.dispatchers.engine-dispatcher-5 INFO  - Assigned new job execution tokens to the following groups: b91103f9: 1
2026-02-04 19:44:38 cromwell-system-akka.dispatchers.backend-dispatcher-101 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(e855d8bc)MitochondriaPipeline.SubsetBamToChrMAndRevert:NA:1]: `set -e
export GATK_LOCAL_JAR=/root/gatk.jar

mkdir out

this_bam="gs://fc-aou-datasets-controlled/pooled/wgs/cram/v8_delta/wgs_1000000.cram"
this_bai="gs://fc-aou-datasets-controlled/pooled/wgs/cram/v8_delta/wgs_1000000.cram.crai"
this_sample=out/"1000000"






gatk --java-options "-Xmx4500m" PrintReads \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -L /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/chrM.hg38.interval_list \
  -L /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/intervals/NUMTv3_all385.hg38.interval_list \
   \
  --read-filter MateOnSameContigOrNoMappedMateReadFilter \
  --read-filter MateUnmappedAndUnmappedReadFilter \
  --gcs-project-for-requester-pays terra-vpc-sc-17dda7e1 \
  -I ${this_bam} --read-index ${this_bai} \
  -O "${this_sample}.bam"  --cloud-prefetch-buffer 0 --cloud-index-prefetch-buffer 0

echo "Now removing mapping..."
set +e
gatk --java-options "-Xmx4500m" ValidateSamFile \
  -INPUT "${this_sample}.bam" \
  -O output.txt \
  -M VERBOSE \
  -IGNORE_WARNINGS true \
  -MAX_OUTPUT 9999999
cat output.txt | \
  grep 'ERROR.*Mate not found for paired read' | \
  sed -e 's/ERROR::MATE_NOT_FOUND:Read name //g' | \
  sed -e 's/, Mate not found for paired read//g' > read_list.txt
cat read_list.txt | wc -l | sed 's/^ *//g' > "${this_sample}.ct_failed.txt"
if [[ $(tr -d "\r\n" < read_list.txt|wc -c) -eq 0 ]]; then
  cp "${this_sample}.bam" rescued.bam
else
  gatk --java-options "-Xmx4500m" FilterSamReads \
    -I "${this_sample}.bam" \
    -O rescued.bam \
    -READ_LIST_FILE read_list.txt \
    -FILTER excludeReadList
fi
gatk --java-options "-Xmx4500m" RevertSam \
  -INPUT rescued.bam \
  -OUTPUT_BY_READGROUP false \
  -OUTPUT "${this_sample}.unmap.bam" \
  -VALIDATION_STRINGENCY LENIENT \
  -ATTRIBUTE_TO_CLEAR FT \
  -ATTRIBUTE_TO_CLEAR CO \
  -SORT_ORDER queryname \
  -RESTORE_ORIGINAL_QUALITIES false --RESTORE_HARDCLIPS false

set -e
echo "Now getting WGS metrics on the subsetted bam..."
gatk --java-options "-Xmx4500m" CollectWgsMetrics \
  INPUT="${this_sample}.bam" \
  INTERVALS=/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/chrM.hg38.interval_list \
  VALIDATION_STRINGENCY=SILENT \
  REFERENCE_SEQUENCE=/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  OUTPUT="${this_sample}.wgs_metrics.txt" \
  USE_FAST_ALGORITHM=true \
  READ_LENGTH=151 \
  COVERAGE_CAP=100000 \
  INCLUDE_BQ_HISTOGRAM=true \
  THEORETICAL_SENSITIVITY_OUTPUT="${this_sample}.theoretical_sensitivity.txt"

R --vanilla <<CODE
  df = read.table("${this_sample}.wgs_metrics.txt",skip=6,header=TRUE,stringsAsFactors=FALSE,sep='\t',nrows=1)
  write.table(floor(df[,"MEAN_COVERAGE"]), "${this_sample}.mean_coverage.txt", quote=F, col.names=F, row.names=F)
  write.table(df[,"MEDIAN_COVERAGE"], "${this_sample}.median_coverage.txt", quote=F, col.names=F, row.names=F)
CODE

echo "Now preprocessing subsetted bam..."
gatk --java-options "-Xmx4500m" MarkDuplicates \
  INPUT="${this_sample}.bam" \
  OUTPUT=md.bam \
  METRICS_FILE="${this_sample}.duplicate.metrics" \
  VALIDATION_STRINGENCY=SILENT \
   \
  OPTICAL_DUPLICATE_PIXEL_DISTANCE=2500 \
  ASSUME_SORT_ORDER="queryname" \
  CLEAR_DT="false" \
  ADD_PG_TAG_TO_READS=false

gatk --java-options "-Xmx4500m" SortSam \
  INPUT=md.bam \
  OUTPUT="${this_sample}.proc.bam" \
  SORT_ORDER="coordinate" \
  CREATE_INDEX=true \
  MAX_RECORDS_IN_RAM=300000`
2026-02-04 19:44:39 cromwell-system-akka.dispatchers.backend-dispatcher-101 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(e855d8bc)MitochondriaPipeline.SubsetBamToChrMAndRevert:NA:1]: Asking singleton actor to submit a job: job-e855d8bc-mitochondriapipelinesubsetbamtochrmandr-1-cdf661f7
2026-02-04 19:44:41 cromwell-system-akka.dispatchers.backend-dispatcher-101 INFO  - Run operation succeeded projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-e855d8bc-mitochondriapipelinesubsetbamtochrmandr-1-cdf661f7
2026-02-04 19:44:41 cromwell-system-akka.dispatchers.backend-dispatcher-107 INFO  - A job was submitted successfully: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-e855d8bc-mitochondriapipelinesubsetbamtochrmandr-1-cdf661f7
2026-02-04 19:44:43 cromwell-system-akka.dispatchers.backend-dispatcher-101 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(e855d8bc)MitochondriaPipeline.SubsetBamToChrMAndRevert:NA:1]: job id: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-e855d8bc-mitochondriapipelinesubsetbamtochrmandr-1-cdf661f7
2026-02-04 19:44:44 cromwell-system-akka.dispatchers.backend-dispatcher-101 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(e855d8bc)MitochondriaPipeline.SubsetBamToChrMAndRevert:NA:1]: Status change from - to Initializing
2026-02-04 19:48:26 cromwell-system-akka.dispatchers.backend-dispatcher-106 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(e855d8bc)MitochondriaPipeline.SubsetBamToChrMAndRevert:NA:1]: Status change from Initializing to Running
2026-02-04 20:01:39 cromwell-system-akka.dispatchers.backend-dispatcher-107 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(e855d8bc)MitochondriaPipeline.SubsetBamToChrMAndRevert:NA:1]: Status change from Running to Success
2026-02-04 20:01:45 cromwell-system-akka.dispatchers.engine-dispatcher-44 INFO  - e855d8bc-1aff-4b7a-b066-ceb54d032499-SubWorkflowExecutionActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(e855d8bc)SubWorkflow-AlignAndCallR1:-1:1]: Running subworkflow: 825cabe5-0dc3-4309-83a4-0e8ff07097cc, root: b91103f9-dfd9-4179-aa3d-eadc298ca0c9
2026-02-04 20:01:48 cromwell-system-akka.dispatchers.engine-dispatcher-42 INFO  - 825cabe5-0dc3-4309-83a4-0e8ff07097cc-SubWorkflowActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(825cabe5)]: Starting AlignAndCallR1.CallMt
2026-02-04 20:01:49 cromwell-system-akka.dispatchers.engine-dispatcher-36 INFO  - 825cabe5-0dc3-4309-83a4-0e8ff07097cc-SubWorkflowActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(825cabe5)]: Starting AlignAndCallR1.CallNucHCIntegrated
2026-02-04 20:01:51 cromwell-system-akka.dispatchers.engine-dispatcher-8 INFO  - Assigned new job execution tokens to the following groups: b91103f9: 2
2026-02-04 20:02:03 cromwell-system-akka.dispatchers.backend-dispatcher-107 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallMt:NA:1]: `set -e

export GATK_LOCAL_JAR=/root/gatk.jar
echo "Extra arguments for mutect2: """"$cust_interval"

# We need to create these files regardless, even if they stay empty
mkdir out
this_sample=out/"1000000"
this_contamination="0.0"
this_basename="${this_sample}"
bamoutfile="${this_basename}.bamout.bam"
touch "${bamoutfile}"
if [[ false == 'true' ]]; then bamoutstr="--bam-output ${bamoutfile}"; else bamoutstr=""; fi

gatk --java-options "-Xmx6500m" Mutect2 \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta \
  -I /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-SubsetBamToChrMAndRevert/out/1000000.proc.bam \
  -L /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/chrM.hg38.interval_list \
  -O "${this_basename}.raw.vcf" \
   \
  --annotation StrandBiasBySample \
  --read-filter MateOnSameContigOrNoMappedMateReadFilter \
  --read-filter MateUnmappedAndUnmappedReadFilter \
  --mitochondria-mode \
  --max-reads-per-alignment-start 75 \
  --max-mnp-distance 0 ${bamoutstr}

echo "Now running filtering..."
gatk --java-options "-Xmx6500m" FilterMutectCalls -V "${this_basename}.raw.vcf" \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta \
  -O filtered.vcf \
  --stats "${this_basename}.raw.vcf.stats" \
   --min-median-mapping-quality 0 \
  --max-alt-allele-count 4 \
  --mitochondria-mode \
  --min-allele-fraction 0.0 \
   \
  --contamination-estimate "${this_contamination}"

gatk IndexFeatureFile -I /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/blacklist_sites.hg38.chrM.bed

gatk --java-options "-Xmx6500m" VariantFiltration -V filtered.vcf \
  -O "${this_basename}.filtered.vcf" \
  --apply-allele-specific-filters \
  --mask-name 'blacklisted_site' --mask /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/blacklist_sites.hg38.chrM.bed

echo "Now splitting multi-allelics..."
gatk --java-options "-Xmx6500m" LeftAlignAndTrimVariants \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta \
  -V "${this_basename}.filtered.vcf" \
  -O split.vcf \
  --split-multi-allelics \
  --dont-trim-alleles \
  --keep-original-ac

gatk --java-options "-Xmx6500m" SelectVariants \
  -V split.vcf \
  -O "${this_basename}.splitAndPassOnly.vcf" \
  --exclude-filtered`
2026-02-04 20:02:03 cromwell-system-akka.dispatchers.backend-dispatcher-107 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallMt:NA:1]: Asking singleton actor to submit a job: job-825cabe5-alignandcallr1callmt-1-fa93d88c
2026-02-04 20:02:03 cromwell-system-akka.dispatchers.backend-dispatcher-107 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallMt:NA:1]: To comply with GCE custom machine requirements, memory was adjusted from 7000 MB to 7168 MB
2026-02-04 20:02:06 cromwell-system-akka.dispatchers.backend-dispatcher-121 INFO  - Run operation succeeded projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callmt-1-fa93d88c
2026-02-04 20:02:06 cromwell-system-akka.dispatchers.backend-dispatcher-121 INFO  - A job was submitted successfully: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callmt-1-fa93d88c
2026-02-04 20:02:08 cromwell-system-akka.dispatchers.backend-dispatcher-123 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallMt:NA:1]: job id: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callmt-1-fa93d88c
2026-02-04 20:02:08 cromwell-system-akka.dispatchers.backend-dispatcher-123 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:1]: `set -e

export GATK_LOCAL_JAR=/root/gatk.jar

mkdir out
this_sample=out/"1000000"
this_basename="${this_sample}"".nuc"
bamoutfile="${this_basename}.bamout.bam"
# Cromwell doesn't like optional task outputs, so we have to touch this file
touch "${bamoutfile}"

if [[ false == 'true' ]]; then bamoutstr="--bam-output ${this_basename}.bamout.bam"; else bamoutstr=""; fi
  
gatk --java-options "-Xmx3500m" HaplotypeCaller \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -I /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-SubsetBamToChrMAndRevert/out/1000000.proc.bam \
  -L /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/intervals/NUMTv3_all385.hg38.interval_list \
  -O "${this_basename}.raw.vcf" \
   \
  -contamination 0 \
   \
  --max-reads-per-alignment-start 75 \
  --max-mnp-distance 0 \
  --annotation StrandBiasBySample \
  -G StandardAnnotation -G StandardHCAnnotation \
  -GQB 10 -GQB 20 -GQB 30 -GQB 40 -GQB 50 -GQB 60 -GQB 70 -GQB 80 -GQB 90 ${bamoutstr}

echo "Now applying hard filters..."
gatk --java-options "-Xmx3500m" SelectVariants -V "${this_basename}.raw.vcf" -select-type SNP -O snps.vcf
gatk --java-options "-Xmx3500m" VariantFiltration -V snps.vcf \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -O snps_filtered.vcf \
  -filter "QD < 2.0" --filter-name "QD2" \
  -filter "QUAL < 30.0" --filter-name "QUAL30" \
  -filter "SOR > 3.0" --filter-name "SOR3" \
  -filter "FS > 60.0" --filter-name "FS60" \
  -filter "MQ < 40.0" --filter-name "MQ40" \
  -filter "MQRankSum < -12.5" --filter-name "MQRankSum-12.5" \
  -filter "ReadPosRankSum < -8.0" --filter-name "ReadPosRankSum-8" \
  --genotype-filter-expression "isHet == 1" --genotype-filter-name "isHetFilt" \
  --genotype-filter-expression "isHomRef == 1" --genotype-filter-name "isHomRefFilt" \
  --genotype-filter-expression "DP < 10" --genotype-filter-name "genoDP10"

gatk --java-options "-Xmx3500m" SelectVariants -V "${this_basename}.raw.vcf" -select-type INDEL -O indels.vcf
gatk --java-options "-Xmx3500m" VariantFiltration -V indels.vcf \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -O indels_filtered.vcf \
  -filter "QD < 2.0" --filter-name "QD2" \
  -filter "QUAL < 30.0" --filter-name "QUAL30" \
  -filter "FS > 200.0" --filter-name "FS200" \
  -filter "SOR > 10.0" --filter-name "SOR10" \
  -filter "ReadPosRankSum < -20.0" --filter-name "ReadPosRankSum-20" \
  --genotype-filter-expression "isHet == 1" --genotype-filter-name "isHetFilt" \
  --genotype-filter-expression "isHomRef == 1" --genotype-filter-name "isHomRefFilt" \
  --genotype-filter-expression "DP < 10" --genotype-filter-name "genoDP10"

gatk --java-options "-Xmx3500m" MergeVcfs -I snps_filtered.vcf -I indels_filtered.vcf -O "${this_basename}.vcf"

echo "Now filtering VCF..."
gatk --java-options "-Xmx3500m" SelectVariants \
  -V "${this_basename}.vcf" \
  --exclude-filtered \
  --set-filtered-gt-to-nocall \
  --exclude-non-variants \
  -O "${this_basename}.pass.vcf"

gatk --java-options "-Xmx3500m" CountVariants -V $this_basename.pass.vcf | tail -n1 > "${this_basename}.passvars.txt"

echo "Now splitting multi-allelics..."
gatk --java-options "-Xmx3500m" LeftAlignAndTrimVariants \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -V "${this_basename}.pass.vcf" \
  -O "${this_basename}.pass.split.vcf" \
  --split-multi-allelics \
  --dont-trim-alleles \
  --keep-original-ac \
  --create-output-variant-index`
2026-02-04 20:02:08 cromwell-system-akka.dispatchers.backend-dispatcher-123 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:1]: Asking singleton actor to submit a job: job-825cabe5-alignandcallr1callnuchcintegrated-1-be347472
2026-02-04 20:02:08 cromwell-system-akka.dispatchers.backend-dispatcher-123 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:1]: To comply with GCE custom machine requirements, memory was adjusted from 4000 MB to 4096 MB
2026-02-04 20:02:10 cromwell-system-akka.dispatchers.backend-dispatcher-124 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallMt:NA:1]: Status change from - to Initializing
2026-02-04 20:02:10 cromwell-system-akka.dispatchers.backend-dispatcher-121 INFO  - Run operation succeeded projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callnuchcintegrated-1-be347472
2026-02-04 20:02:10 cromwell-system-akka.dispatchers.backend-dispatcher-114 INFO  - A job was submitted successfully: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callnuchcintegrated-1-be347472
2026-02-04 20:02:13 cromwell-system-akka.dispatchers.backend-dispatcher-128 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:1]: job id: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callnuchcintegrated-1-be347472
2026-02-04 20:02:13 cromwell-system-akka.dispatchers.backend-dispatcher-124 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:1]: Status change from - to Initializing
2026-02-04 20:06:59 cromwell-system-akka.dispatchers.backend-dispatcher-123 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallMt:NA:1]: Status change from Initializing to Running
2026-02-04 20:07:09 cromwell-system-akka.dispatchers.backend-dispatcher-140 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:1]: Status change from Initializing to Failed
2026-02-04 20:07:14 cromwell-system-akka.dispatchers.engine-dispatcher-38 INFO  - 825cabe5-0dc3-4309-83a4-0e8ff07097cc-SubWorkflowActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(825cabe5)]: Retrying job execution for AlignAndCallR1.CallNucHCIntegrated:NA:2
2026-02-04 20:07:14 cromwell-system-akka.dispatchers.engine-dispatcher-38 INFO  - 825cabe5-0dc3-4309-83a4-0e8ff07097cc-SubWorkflowActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(825cabe5)]: Starting AlignAndCallR1.CallNucHCIntegrated
2026-02-04 20:07:15 cromwell-system-akka.dispatchers.engine-dispatcher-36 INFO  - Assigned new job execution tokens to the following groups: b91103f9: 1
2026-02-04 20:07:33 cromwell-system-akka.dispatchers.backend-dispatcher-88 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:2]: `set -e

export GATK_LOCAL_JAR=/root/gatk.jar

mkdir out
this_sample=out/"1000000"
this_basename="${this_sample}"".nuc"
bamoutfile="${this_basename}.bamout.bam"
# Cromwell doesn't like optional task outputs, so we have to touch this file
touch "${bamoutfile}"

if [[ false == 'true' ]]; then bamoutstr="--bam-output ${this_basename}.bamout.bam"; else bamoutstr=""; fi
  
gatk --java-options "-Xmx3500m" HaplotypeCaller \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -I /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-SubsetBamToChrMAndRevert/out/1000000.proc.bam \
  -L /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/intervals/NUMTv3_all385.hg38.interval_list \
  -O "${this_basename}.raw.vcf" \
   \
  -contamination 0 \
   \
  --max-reads-per-alignment-start 75 \
  --max-mnp-distance 0 \
  --annotation StrandBiasBySample \
  -G StandardAnnotation -G StandardHCAnnotation \
  -GQB 10 -GQB 20 -GQB 30 -GQB 40 -GQB 50 -GQB 60 -GQB 70 -GQB 80 -GQB 90 ${bamoutstr}

echo "Now applying hard filters..."
gatk --java-options "-Xmx3500m" SelectVariants -V "${this_basename}.raw.vcf" -select-type SNP -O snps.vcf
gatk --java-options "-Xmx3500m" VariantFiltration -V snps.vcf \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -O snps_filtered.vcf \
  -filter "QD < 2.0" --filter-name "QD2" \
  -filter "QUAL < 30.0" --filter-name "QUAL30" \
  -filter "SOR > 3.0" --filter-name "SOR3" \
  -filter "FS > 60.0" --filter-name "FS60" \
  -filter "MQ < 40.0" --filter-name "MQ40" \
  -filter "MQRankSum < -12.5" --filter-name "MQRankSum-12.5" \
  -filter "ReadPosRankSum < -8.0" --filter-name "ReadPosRankSum-8" \
  --genotype-filter-expression "isHet == 1" --genotype-filter-name "isHetFilt" \
  --genotype-filter-expression "isHomRef == 1" --genotype-filter-name "isHomRefFilt" \
  --genotype-filter-expression "DP < 10" --genotype-filter-name "genoDP10"

gatk --java-options "-Xmx3500m" SelectVariants -V "${this_basename}.raw.vcf" -select-type INDEL -O indels.vcf
gatk --java-options "-Xmx3500m" VariantFiltration -V indels.vcf \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -O indels_filtered.vcf \
  -filter "QD < 2.0" --filter-name "QD2" \
  -filter "QUAL < 30.0" --filter-name "QUAL30" \
  -filter "FS > 200.0" --filter-name "FS200" \
  -filter "SOR > 10.0" --filter-name "SOR10" \
  -filter "ReadPosRankSum < -20.0" --filter-name "ReadPosRankSum-20" \
  --genotype-filter-expression "isHet == 1" --genotype-filter-name "isHetFilt" \
  --genotype-filter-expression "isHomRef == 1" --genotype-filter-name "isHomRefFilt" \
  --genotype-filter-expression "DP < 10" --genotype-filter-name "genoDP10"

gatk --java-options "-Xmx3500m" MergeVcfs -I snps_filtered.vcf -I indels_filtered.vcf -O "${this_basename}.vcf"

echo "Now filtering VCF..."
gatk --java-options "-Xmx3500m" SelectVariants \
  -V "${this_basename}.vcf" \
  --exclude-filtered \
  --set-filtered-gt-to-nocall \
  --exclude-non-variants \
  -O "${this_basename}.pass.vcf"

gatk --java-options "-Xmx3500m" CountVariants -V $this_basename.pass.vcf | tail -n1 > "${this_basename}.passvars.txt"

echo "Now splitting multi-allelics..."
gatk --java-options "-Xmx3500m" LeftAlignAndTrimVariants \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  -V "${this_basename}.pass.vcf" \
  -O "${this_basename}.pass.split.vcf" \
  --split-multi-allelics \
  --dont-trim-alleles \
  --keep-original-ac \
  --create-output-variant-index`
2026-02-04 20:07:33 cromwell-system-akka.dispatchers.backend-dispatcher-88 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:2]: Asking singleton actor to submit a job: job-825cabe5-alignandcallr1callnuchcintegrated-2-4d6c671a
2026-02-04 20:07:33 cromwell-system-akka.dispatchers.backend-dispatcher-88 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:2]: To comply with GCE custom machine requirements, memory was adjusted from 4000 MB to 4096 MB
2026-02-04 20:07:36 cromwell-system-akka.dispatchers.backend-dispatcher-138 INFO  - Run operation succeeded projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callnuchcintegrated-2-4d6c671a
2026-02-04 20:07:36 cromwell-system-akka.dispatchers.backend-dispatcher-139 INFO  - A job was submitted successfully: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callnuchcintegrated-2-4d6c671a
2026-02-04 20:07:38 cromwell-system-akka.dispatchers.backend-dispatcher-140 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:2]: job id: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1callnuchcintegrated-2-4d6c671a
2026-02-04 20:07:39 cromwell-system-akka.dispatchers.backend-dispatcher-131 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:2]: Status change from - to Initializing
2026-02-04 20:11:52 cromwell-system-akka.dispatchers.backend-dispatcher-142 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:2]: Status change from Initializing to Running
2026-02-04 20:17:18 cromwell-system-akka.dispatchers.backend-dispatcher-131 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallMt:NA:1]: Status change from Running to Success
2026-02-04 20:17:20 cromwell-system-akka.dispatchers.engine-dispatcher-38 INFO  - 825cabe5-0dc3-4309-83a4-0e8ff07097cc-SubWorkflowActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(825cabe5)]: Starting AlignAndCallR1.GetContamination
2026-02-04 20:17:21 cromwell-system-akka.dispatchers.engine-dispatcher-38 INFO  - Assigned new job execution tokens to the following groups: b91103f9: 1
2026-02-04 20:17:23 cromwell-system-akka.dispatchers.backend-dispatcher-143 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.GetContamination:NA:1]: `set -e

mkdir out
this_basename=out/"1000000"
this_mean_cov="1620"
this_vcf="/mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallMt/out/1000000.splitAndPassOnly.vcf"

this_vcf_nvar=$(cat "${this_vcf}" | grep ^chrM | wc -l | sed 's/^ *//g')
echo "1000000 has VCF with ${this_vcf_nvar} variants for contamination."

# Unzip haplocheck from a pre-staged zip (localized by Cromwell).
zip_path="/mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/haplocheck.zip"
jar xf "${zip_path}"
chmod +x haplocheck

./haplocheck --out output "${this_vcf}"

if [ -s output ]; then
  sed 's/\"//g' output > output-noquotes
else
  : > output-noquotes
fi
# Force SampleID to match the expected sample_name when possible.
if grep -q "SampleID" output-noquotes; then
  awk -F "\t" 'NR==1{print;next}{$1="1000000";print}' output-noquotes > output-noquotes.fixed
  mv output-noquotes.fixed output-noquotes
else
  echo "SampleID header missing; will fall back to NONE defaults."
fi
echo "Haplocheck output file size (bytes):"
wc -c output || true
echo "First 5 lines of output-noquotes:"
head -n 5 output-noquotes || true
echo "SampleID line (if any):"
grep -n "SampleID" output-noquotes || true
cp 'output-noquotes' "${this_basename}_output_noquotes"

FORMAT_ERROR="Bad contamination file format"
if grep -q "SampleID" output-noquotes; then
  grep "SampleID" output-noquotes > headers
  if [ `awk '{print $2}' headers` != "Contamination" ]; then
    echo $FORMAT_ERROR
  fi
  if [ `awk '{print $6}' headers` != "HgMajor" ]; then
    echo $FORMAT_ERROR
  fi
  if [ `awk '{print $8}' headers` != "HgMinor" ]; then
    echo $FORMAT_ERROR
  fi
  if [ `awk '{print $14}' headers` != "MeanHetLevelMajor" ]; then
    echo $FORMAT_ERROR
  fi
  if [ `awk '{print $15}' headers` != "MeanHetLevelMinor" ]; then
    echo $FORMAT_ERROR
  fi
else
  echo $FORMAT_ERROR
fi

if grep -q "SampleID" output-noquotes && grep -v "SampleID" output-noquotes | grep -q . && [ "${this_mean_cov}" -gt 0 ] && [ "${this_vcf_nvar}" -gt 0 ]; then
  grep -v "SampleID" output-noquotes > output-data
  awk -F "\t" '{print $2}' output-data > "${this_basename}.contamination.txt"
  awk -F "\t" '{print $6}' output-data > "${this_basename}.major_hg.txt"
  awk -F "\t" '{print $8}' output-data > "${this_basename}.minor_hg.txt"
  awk -F "\t" '{print $14}' output-data > "${this_basename}.mean_het_major.txt"
  awk -F "\t" '{print $15}' output-data > "${this_basename}.mean_het_minor.txt"
else
  if ! grep -q "SampleID" output-noquotes; then
    echo "SampleID header missing in haplocheck output; writing default contamination outputs."
  elif [ "${this_mean_cov}" -eq 0 ]; then
    echo "Sample 1000000 has a mean coverage of 0."
  elif [ "${this_vcf_nvar}" -eq 0 ]; then
    echo "Sample 1000000 has no variants."
  else
    echo "Unsupported contamination exception for 1000000. Falling back to NONE defaults."
  fi
  
  echo "NO" > "${this_basename}.contamination.txt"
  echo "NONE" > "${this_basename}.major_hg.txt"
  echo "NONE" > "${this_basename}.minor_hg.txt"
  echo "0.000" > "${this_basename}.mean_het_major.txt"
  echo "0.000" > "${this_basename}.mean_het_minor.txt"
fi`
2026-02-04 20:17:24 cromwell-system-akka.dispatchers.backend-dispatcher-143 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.GetContamination:NA:1]: Asking singleton actor to submit a job: job-825cabe5-alignandcallr1getcontamination-1-0b62286a
2026-02-04 20:17:25 cromwell-system-akka.dispatchers.backend-dispatcher-147 INFO  - Run operation succeeded projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1getcontamination-1-0b62286a
2026-02-04 20:17:25 cromwell-system-akka.dispatchers.backend-dispatcher-147 INFO  - A job was submitted successfully: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1getcontamination-1-0b62286a
2026-02-04 20:17:28 cromwell-system-akka.dispatchers.backend-dispatcher-147 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.GetContamination:NA:1]: job id: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1getcontamination-1-0b62286a
2026-02-04 20:17:28 cromwell-system-akka.dispatchers.backend-dispatcher-138 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.GetContamination:NA:1]: Status change from - to Initializing
2026-02-04 20:18:55 cromwell-system-akka.dispatchers.backend-dispatcher-145 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.CallNucHCIntegrated:NA:2]: Status change from Running to Success
2026-02-04 20:19:56 cromwell-system-akka.dispatchers.backend-dispatcher-145 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.GetContamination:NA:1]: Status change from Initializing to Running
2026-02-04 20:20:56 cromwell-system-akka.dispatchers.backend-dispatcher-114 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.GetContamination:NA:1]: Status change from Running to Success
2026-02-04 20:21:00 cromwell-system-akka.dispatchers.engine-dispatcher-44 INFO  - 825cabe5-0dc3-4309-83a4-0e8ff07097cc-SubWorkflowActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(825cabe5)]: Starting AlignAndCallR1.FilterContamination
2026-02-04 20:21:03 cromwell-system-akka.dispatchers.engine-dispatcher-44 INFO  - Assigned new job execution tokens to the following groups: b91103f9: 1
2026-02-04 20:21:13 cromwell-system-akka.dispatchers.backend-dispatcher-114 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.FilterContamination:NA:1]: `set -e

export GATK_LOCAL_JAR=/root/gatk.jar

mkdir out

this_sample=out/"1000000"
this_raw_vcf="/mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallMt/out/1000000.filtered.vcf"
this_raw_stats="/mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallMt/out/1000000.raw.vcf.stats"
this_has_contam="NO"
this_verifybam="0.0"
this_contam_major="0.0"
this_contam_minor="0.0"

this_basename="${this_sample}"
bamoutfile="${this_basename}.bamout.bam"
touch "${bamoutfile}"

if [[ "${this_has_contam}" == 'YES' ]]; then
  if (( $(echo "${this_contam_major} == 0.0"|bc -l) )); then
    this_hc_contamination="${this_contam_minor}"
  else
    this_hc_contamination=$( bc <<< "1-${this_contam_major}" )
  fi
else
  this_hc_contamination=0.0
fi

echo "${this_hc_contamination}" > "${this_basename}.hc_contam.txt"

if (( $(echo "${this_verifybam} > ${this_hc_contamination}"|bc -l) )); then
  this_max_contamination="${this_verifybam}"
else
  this_max_contamination="${this_hc_contamination}"
fi

echo "VerifyBam: ${this_verifybam}; HC: ${this_hc_contamination}; Max: ${this_max_contamination}"

gatk --java-options "-Xmx2500m" FilterMutectCalls \
  -V "${this_raw_vcf}" \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta \
  -O filtered.vcf \
  --stats "${this_raw_stats}" \
   --min-median-mapping-quality 0 \
  --max-alt-allele-count 4 \
  --mitochondria-mode \
   \
   \
  --contamination-estimate "${this_max_contamination}"

gatk IndexFeatureFile -I /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/blacklist_sites.hg38.chrM.bed

gatk --java-options "-Xmx2500m" VariantFiltration \
  -V filtered.vcf \
  -O "${this_basename}.vcf" \
  --apply-allele-specific-filters \
  --mask-name 'blacklisted_site' --mask /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/blacklist_sites.hg38.chrM.bed

echo "Now splitting multi-allelics..."
gatk --java-options "-Xmx2500m" LeftAlignAndTrimVariants \
  -R /mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta \
  -V "${this_basename}.vcf" \
  -O "${this_basename}.split.vcf" \
  --split-multi-allelics \
  --dont-trim-alleles \
  --keep-original-ac \
  --create-output-variant-index`
2026-02-04 20:21:13 cromwell-system-akka.dispatchers.backend-dispatcher-154 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.FilterContamination:NA:1]: Asking singleton actor to submit a job: job-825cabe5-alignandcallr1filtercontamination-1-57f5e2fd
2026-02-04 20:21:13 cromwell-system-akka.dispatchers.backend-dispatcher-154 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.FilterContamination:NA:1]: To comply with GCE custom machine requirements, memory was adjusted from 4 MB to 2048 MB
2026-02-04 20:21:17 cromwell-system-akka.dispatchers.backend-dispatcher-153 INFO  - Run operation succeeded projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1filtercontamination-1-57f5e2fd
2026-02-04 20:21:17 cromwell-system-akka.dispatchers.backend-dispatcher-145 INFO  - A job was submitted successfully: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1filtercontamination-1-57f5e2fd
2026-02-04 20:21:18 cromwell-system-akka.dispatchers.backend-dispatcher-153 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.FilterContamination:NA:1]: job id: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-825cabe5-alignandcallr1filtercontamination-1-57f5e2fd
2026-02-04 20:21:20 cromwell-system-akka.dispatchers.backend-dispatcher-131 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.FilterContamination:NA:1]: Status change from - to Initializing
2026-02-04 20:25:52 cromwell-system-akka.dispatchers.backend-dispatcher-156 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.FilterContamination:NA:1]: Status change from Initializing to Running
2026-02-04 20:26:53 cromwell-system-akka.dispatchers.backend-dispatcher-153 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(825cabe5)AlignAndCallR1.FilterContamination:NA:1]: Status change from Running to Success
2026-02-04 20:27:00 cromwell-system-akka.dispatchers.engine-dispatcher-37 INFO  - 825cabe5-0dc3-4309-83a4-0e8ff07097cc-SubWorkflowActor-SubWorkflow-AlignAndCallR1:-1:1 [UUID(825cabe5)]: Workflow AlignAndCallR1 complete. Final Outputs:
{
  "AlignAndCallR1.split_nuc_vcf": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallNucHCIntegrated/attempt-2/out/1000000.nuc.pass.split.vcf",
  "AlignAndCallR1.out_vcf_index": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-FilterContamination/out/1000000.vcf.idx",
  "AlignAndCallR1.nuc_vcf_unfiltered": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallNucHCIntegrated/attempt-2/out/1000000.nuc.vcf",
  "AlignAndCallR1.split_vcf_index": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-FilterContamination/out/1000000.split.vcf.idx",
  "AlignAndCallR1.contamination_metrics": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-GetContamination/out/1000000_output_noquotes",
  "AlignAndCallR1.nuc_vcf_index": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallNucHCIntegrated/attempt-2/out/1000000.nuc.pass.vcf.idx",
  "AlignAndCallR1.hasContamination": "NO",
  "AlignAndCallR1.input_vcf_for_haplochecker": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallMt/out/1000000.splitAndPassOnly.vcf",
  "AlignAndCallR1.contamination_major": 0.0,
  "AlignAndCallR1.nuc_variants_pass": 544,
  "AlignAndCallR1.split_vcf": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-FilterContamination/out/1000000.split.vcf",
  "AlignAndCallR1.nuc_vcf": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallNucHCIntegrated/attempt-2/out/1000000.nuc.pass.vcf",
  "AlignAndCallR1.split_nuc_vcf_index": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallNucHCIntegrated/attempt-2/out/1000000.nuc.pass.split.vcf.idx",
  "AlignAndCallR1.contamination_minor": 0.0,
  "AlignAndCallR1.major_haplogroup": "NONE",
  "AlignAndCallR1.out_vcf": "gs://fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-FilterContamination/out/1000000.vcf",
  "AlignAndCallR1.contamination": 0.0
}
2026-02-04 20:27:05 cromwell-system-akka.dispatchers.engine-dispatcher-37 INFO  - e855d8bc-1aff-4b7a-b066-ceb54d032499-SubWorkflowExecutionActor-SubWorkflow-ProduceSelfRefFiles:-1:1 [UUID(e855d8bc)SubWorkflow-ProduceSelfRefFiles:-1:1]: Running subworkflow: 83858836-9cd1-409c-95bc-ffa5ca4f6d82, root: b91103f9-dfd9-4179-aa3d-eadc298ca0c9
2026-02-04 20:27:07 cromwell-system-akka.dispatchers.engine-dispatcher-5 INFO  - 83858836-9cd1-409c-95bc-ffa5ca4f6d82-SubWorkflowActor-SubWorkflow-ProduceSelfRefFiles:-1:1 [UUID(83858836)]: Starting ProduceSelfReferenceFiles.ProduceSelfReference
2026-02-04 20:27:09 cromwell-system-akka.dispatchers.engine-dispatcher-36 INFO  - Assigned new job execution tokens to the following groups: b91103f9: 1
2026-02-04 20:27:09 pool-7-thread-8 INFO  - Request threw an exception on attempt #1. Retrying after 755 milliseconds
org.http4s.blaze.pipeline.Command$EOF$: EOF
2026-02-04 20:27:10 cromwell-system-akka.dispatchers.backend-dispatcher-158 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(83858836)ProduceSelfReferenceFiles.ProduceSelfReference:NA:1]: `set -e

mkdir out

java -jar /usr/gitc/picard.jar IntervalListTools SORT=true I=/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/chrM.hg38.interval_list O=internal_mt.interval_list
java -jar /usr/gitc/picard.jar IntervalListTools SORT=true I=/mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/intervals/NUMTv3_all385.hg38.interval_list O=internal_nuc.interval_list

java -jar /usr/gitc/picard.jar ExtractSequences \
  INTERVAL_LIST=internal_mt.interval_list \
  R=/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta \
  O=mt_fasta.fasta
Rscript --vanilla /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/compatibilify_fa_intervals_consensus.R mt_fasta.fasta internal_mt.interval_list FALSE mt_fasta_renamed.fasta TRUE
samtools faidx mt_fasta_renamed.fasta

this_nuc_vcf="/mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-CallNucHCIntegrated/attempt-2/out/1000000.nuc.pass.split.vcf"
this_mt_vcf="/mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/workflows/cromwell-executions/MitochondriaPipelineWrapper/b91103f9-dfd9-4179-aa3d-eadc298ca0c9/call-MitochondriaPipeline_v2_5/shard-0/MitochondriaPipeline/e855d8bc-1aff-4b7a-b066-ceb54d032499/call-AlignAndCallR1/AlignAndCallR1/825cabe5-0dc3-4309-83a4-0e8ff07097cc/call-FilterContamination/out/1000000.split.vcf"
this_samp_name="1000000"
this_sample=out/"1000000"

this_mt_chain=out/reference_to_"${this_samp_name}.chain"
this_nuc_chain=out/reference_to_"${this_samp_name}NucOnly.chain"
this_basename="${this_sample}.self.ref"
this_basename_both="${this_sample}andNuc.self.ref"
this_basename_nuc="${this_sample}NucOnly.self.ref"
this_shifted_basename="${this_basename}.shifted_by_8000_bases"
this_shifted_basename_append="${this_shifted_basename}.cat"

this_filt_vcf="${this_sample}.mtref.homoplasmies.vcf"
this_mt_fasta="${this_basename}.fasta"
this_nuc_mt_fasta="${this_basename_both}.fasta"
this_nuc_only_fasta="${this_basename_nuc}.fasta"
this_fasta_shifted="${this_shifted_basename}.fasta"
this_fasta_cat_shifted="${this_shifted_basename_append}.fasta"
this_chain_shifted="${this_shifted_basename}.shift_back_8000_bases.chain"
this_chain_fwd_shifted="${this_shifted_basename}.shift_fwd_8000_bases.chain"
this_mt_intervals=out/"chrM.hg38.${this_samp_name}.SelfRefLiftover.interval_list"
this_nonctrl_interval=out/"non_control_region.chrM.${this_samp_name}.SelfRefLiftover.interval_list"
this_ctrl_interval=out/control_region_shifted.chrM."${this_samp_name}.SelfRefLiftover.interval_list"

this_vcf_bgz="${this_basename}.reversed.selfRef.homoplasmies.vcf.bgz"
this_vcf_filters_bgz="${this_basename}.reversed.withfilters.selfRef.homoplasmies.vcf.bgz"
this_vcf_shifted_bgz="${this_basename}.reversed.selfRef.shifted.homoplasmies.vcf.bgz"


bgzip -c "${this_mt_vcf}" > input_mt_vcf.gz && tabix input_mt_vcf.gz
bcftools view -Oz -i 'FORMAT/AF>0.95' input_mt_vcf.gz > "${this_filt_vcf}.gz"
tabix "${this_filt_vcf}.gz"
bgzip -cd "${this_filt_vcf}.gz" > "${this_filt_vcf}"


Rscript --vanilla /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/check_overlapping_homoplasmies.R "${this_sample}" "${this_filt_vcf}" "${this_nuc_vcf}" FALSE
bgzip -c "overlapping_variants_to_remove.vcf" > mt_overlaps_rm.vcf.gz && tabix mt_overlaps_rm.vcf.gz
bcftools isec "${this_filt_vcf}.gz" mt_overlaps_rm.vcf.gz -p output_isec
export private_to_rem=$(cat ./output_isec/0001.vcf | grep ^chr | wc -l | sed 's/^ *//g')
if [ $private_to_rem -ne 0 ]; then
  echo "ERROR: There should not be any variants private to the VCF for removal."
  exit 1;
fi
export shared_by_both=$(cat ./output_isec/0002.vcf | grep ^chr | wc -l | sed 's/^ *//g')
export for_removal=$(cat overlapping_variants_to_remove.vcf | grep ^chr | wc -l | sed 's/^ *//g')
if [ $shared_by_both -ne $for_removal ]; then
  echo "ERROR: The number of variants shared by both rejected VCF and MT VCF should be the number of variants for removal."
  exit 1;
fi
export only_undupe=$(cat ./output_isec/0000.vcf | grep ^chr | wc -l | sed 's/^ *//g')
export original_nrow=$(cat "${this_filt_vcf}" | grep ^chr | wc -l | sed 's/^ *//g')
if [ "$((original_nrow-for_removal))" -ne $only_undupe ]; then
  echo "ERROR: New VCF should be smaller than old VCF by the exact number of records for removal."
  exit 1;
fi
Rscript --vanilla /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/check_overlapping_homoplasmies.R "temp" "output_isec/0000.vcf" "${this_nuc_vcf}" TRUE
rm "${this_filt_vcf}.gz" "${this_filt_vcf}" "${this_filt_vcf}.gz.tbi" mt_overlaps_rm.vcf.gz mt_overlaps_rm.vcf.gz.tbi overlapping_variants_to_remove.vcf
cp "output_isec/0000.vcf" "${this_filt_vcf}"
bgzip -c "${this_filt_vcf}" > "${this_filt_vcf}".gz && tabix "${this_filt_vcf}".gz
rm -rf output_isec


bcftools consensus -f mt_fasta_renamed.fasta -o mt_fasta_lifted.fasta -c "${this_mt_chain}" "${this_filt_vcf}.gz"
Rscript --vanilla /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/compatibilify_fa_intervals_consensus.R mt_fasta_lifted.fasta internal_mt.interval_list TRUE "${this_mt_fasta}" TRUE
java -Xmx1000m -jar /usr/gitc/picard.jar \
  CreateSequenceDictionary \
  REFERENCE="${this_mt_fasta}" \
  OUTPUT="${this_basename}.dict"
samtools faidx "${this_mt_fasta}"

Rscript --vanilla /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/check_variant_bounds.R "${this_nuc_vcf}" internal_nuc.interval_list rejected_nuc.vcf
bgzip -c "${this_nuc_vcf}" > input_nuc_vcf.gz && tabix input_nuc_vcf.gz
bgzip -c rejected_nuc.vcf > rejected_nuc.vcf.gz && tabix rejected_nuc.vcf.gz
bcftools isec -p intersected_vcfs -Ov input_nuc_vcf.gz rejected_nuc.vcf.gz
export private_to_rej=$(cat ./intersected_vcfs/0001.vcf | grep ^chr | wc -l | sed 's/^ *//g')
if [ $private_to_rej -ne 0 ]; then
  echo "ERROR: There should not be any variants private to the rejected VCF."
  exit 1;
fi
cat ./intersected_vcfs/0002.vcf | grep ^chr | wc -l | sed 's/^ *//g' > "${this_sample}.nuc.removed.txt"

java -jar /usr/gitc/picard.jar ExtractSequences \
  INTERVAL_LIST=internal_nuc.interval_list \
  R=/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/Homo_sapiens_assembly38.fasta \
  O=nuc_fasta.fasta
Rscript --vanilla /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/compatibilify_fa_intervals_consensus.R nuc_fasta.fasta internal_nuc.interval_list FALSE nuc_fasta_renamed.fasta FALSE
samtools faidx nuc_fasta_renamed.fasta
bgzip -c ./intersected_vcfs/0000.vcf > filtered_nuc_vcf.gz && tabix filtered_nuc_vcf.gz
bcftools consensus -f nuc_fasta_renamed.fasta -o nuc_fasta_lifted.fasta -c "${this_nuc_chain}" filtered_nuc_vcf.gz
Rscript --vanilla /mnt/disks/cromwell_root/fc-secure-76d68a64-00aa-40a7-b2c5-ca956db2719b/code/compatibilify_fa_intervals_consensus.R nuc_fasta_lifted.fasta internal_nuc.interval_list TRUE "${this_nuc_only_fasta}" FALSE
cat "${this_nuc_only_fasta}" "${this_mt_fasta}" > "${this_nuc_mt_fasta}"
#/usr/gitc/bwa index ${this_nuc_mt_fasta}
java -Xmx1000m -jar /usr/gitc/picard.jar \
  CreateSequenceDictionary \
  REFERENCE="${this_nuc_mt_fasta}" \
  OUTPUT="${this_basename_both}.dict"
samtools faidx "${this_nuc_mt_fasta}"

java -Xmx1000m -jar /usr/gitc/picard.jar \
  CreateSequenceDictionary \
  REFERENCE="${this_nuc_only_fasta}" \
  OUTPUT="${this_basename_nuc}.dict"
samtools faidx "${this_nuc_only_fasta}"

echo "Now shifting the reference..."
R --vanilla <<CODE
  full_fasta <- readLines("${this_mt_fasta}")
  topline <- full_fasta[1]
  linelen <- nchar(full_fasta[2])
  n_shift <- 8000
  other_lines <- paste0(full_fasta[2:length(full_fasta)],collapse='')
  other_lines_shifted <- paste0(substr(other_lines, n_shift+1, nchar(other_lines)), substr(other_lines, 1, n_shift))
  len_chr <- nchar(other_lines_shifted)
  shifted_split <- substring(other_lines_shifted, seq(1, len_chr, linelen), unique(c(seq(linelen, len_chr, linelen), len_chr)))
  final_data <- c(topline, shifted_split)
  writeLines(final_data, "${this_fasta_shifted}")
  
  total_len <- nchar(other_lines)
  sec1 <- paste(c('chain',9999,'chrM',total_len,'+', 0,total_len-n_shift, 'chrM', total_len, '+', n_shift, total_len, 1),collapse=' ')
  sec2 <- paste(c('chain',9999,'chrM',total_len,'+', total_len-n_shift,total_len, 'chrM', total_len, '+', 0, n_shift, 2),collapse=' ')
  writeLines(c(sec1, total_len-n_shift, '', sec2, n_shift, ''), "${this_chain_shifted}")
  
  sec1_f <- paste(c('chain',9999,'chrM',total_len,'+', n_shift,total_len, 'chrM', total_len, '+', 0, total_len-n_shift, 1),collapse=' ')
  sec2_f <- paste(c('chain',9999,'chrM',total_len,'+', 0, n_shift, 'chrM', total_len, '+', total_len-n_shift, total_len, 2),collapse=' ')
  writeLines(c(sec1_f, total_len-n_shift, '', sec2_f, n_shift, ''), "${this_chain_fwd_shifted}")
CODE

cat "${this_fasta_shifted}" "${this_nuc_only_fasta}" > "${this_fasta_cat_shifted}"

#/usr/gitc/bwa index ${this_fasta_cat_shifted}
java -Xmx1000m -jar /usr/gitc/picard.jar \
  CreateSequenceDictionary \
  REFERENCE="${this_fasta_cat_shifted}" \
  OUTPUT="${this_shifted_basename_append}.dict"
samtools faidx "${this_fasta_cat_shifted}"

java -Xmx1000m -jar /usr/gitc/picard.jar \
  CreateSequenceDictionary \
  REFERENCE="${this_fasta_shifted}" \
  OUTPUT="${this_shifted_basename}.dict"
samtools faidx "${this_fasta_shifted}"

echo "Now adjusting the MT interval list..."
R --vanilla <<CODE
  intervals <- readLines("/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/chrM.hg38.interval_list")
  intervals <- intervals[grep('^@', intervals, invert=T)]
  interval_names <- sapply(strsplit(intervals, '\t'),function(x)x[5])
  new_header <- readLines("${this_basename}.dict")
  lens <- sapply(interval_names, function(x)as.numeric(gsub('LN:','',strsplit(new_header[grep(paste0('^@SQ\tSN:',x), new_header)[1]], '\t')[[1]][3])))
  if(any(is.na(lens))) stop('ERROR: Some NUMT intervals were not found in the mt_andNuc sequence dictionary.')
  new_intervals <- c(new_header, paste(interval_names, 1, lens, '+', interval_names, sep='\t'))
  writeLines(new_intervals, "${this_mt_intervals}")
CODE

echo "Now shifting the noncontrol region..."
java -jar /usr/gitc/picard.jar LiftOverIntervalList \
  I="/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/non_control_region.chrM.interval_list" \
  O="${this_nonctrl_interval}" \
  SD="${this_basename}.dict" \
  CHAIN="${this_mt_chain}"

echo "Now shifting the control region..."
R --vanilla <<CODE
  full_intervals <- readLines("${this_nonctrl_interval}")
  correct_dict <- readLines("${this_shifted_basename}.dict")
  n_shift <- 8000
  if (length(full_intervals) > 3) {
    stop('ERROR: there should be only 3 lines in interval list.')
  }
  if ((length(grep('^@', full_intervals)) != 2) | (length(grep('^chrM', full_intervals)) != 1)) {
    stop('ERROR: there should be 2 comment lines and one interval line on chrM')
  }
  out_intervals <- c(full_intervals[1], correct_dict[2])
  split_line2 <- strsplit(out_intervals[2],'\t')[[1]]
  this_len <- as.numeric(gsub('^LN:','',split_line2[grep('^LN', split_line2)[1]]))

  interval <- strsplit(full_intervals[3],'\t')[[1]]
  new_end <- as.numeric(interval[2]) - 1 + this_len - n_shift
  new_start <- as.numeric(interval[3]) + 1 - n_shift
  interval[2:3] <- c(as.character(new_start), as.character(new_end))
  out_intervals <- c(out_intervals, paste0(interval, collapse='\t'))

  writeLines(out_intervals, "${this_ctrl_interval}")
CODE

echo "Now making force call variants..."
python3.7 <<CODE
import hail as hl

def fai_to_len(fai):
    with open(fai) as f:
        line = f.readline()
    return int(line.split('\t')[1])

def check_vcf_integrity(mt):
    # check that locus, alleles are the two key fields
    if sorted(list(mt.row_key)) != ['alleles', 'locus']:
        raise ValueError('VCFs must always be keyed by locus, alleles.')
    
    # check that all sites are bi-allelic
    if mt.aggregate_rows(~hl.agg.all(hl.len(mt.alleles) == 2)):
        raise ValueError('This function only supports biallelic sites (run SplitMultiAllelics!)')
    
    # check that there is no missingness in locus
    if mt.aggregate_rows(~hl.agg.all(hl.is_defined(mt.locus))):
        raise ValueError('ERROR: locus must always be defined, both before and after Liftover. This should be a reversible operation, thus finding missing loci after reverse liftover is very concerning.')

    # check that there is no missingness in alleles
    if mt.aggregate_rows(~hl.agg.all(hl.all(hl.map(hl.is_defined, mt.alleles)))):
        raise ValueError('ERROR: alleles should always be defined.')

def apply_conversion(mt, liftover_target, skip_flip=False):
    mt_lifted = mt.annotate_rows(new_locus = hl.liftover(mt.locus, liftover_target))
    if skip_flip:
      mt_lifted = mt_lifted.annotate_rows(allele_flip = mt_lifted.alleles)
    else:
      mt_lifted = mt_lifted.annotate_rows(allele_flip = hl.reversed(mt_lifted.alleles))
    mt_lifted = mt_lifted.key_rows_by().rename({'locus':'locus_orig', 'alleles':'alleles_orig'}).rename({'new_locus':'locus', 'allele_flip': 'alleles'}).key_rows_by('locus','alleles')
    mt_lifted = mt_lifted.drop('locus_orig', 'alleles_orig')

    return mt_lifted

target = hl.ReferenceGenome("target_self", ['chrM'], {'chrM':fai_to_len("${this_mt_fasta}.fai")}, mt_contigs=['chrM'])
source = hl.ReferenceGenome('mtGRCh38', ['chrM'], {'chrM':fai_to_len("/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta.fai")}, mt_contigs=['chrM'])
target.add_sequence("${this_mt_fasta}", "${this_mt_fasta}.fai")
source.add_sequence("/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta", "/mnt/disks/cromwell_root/gcp-public-data--broad-references/hg38/v0/chrM/Homo_sapiens_assembly38.chrM.fasta.fai")
source.add_liftover("${this_mt_chain}", "target_self")
shifted_target = hl.ReferenceGenome("target_self_shifted", ['chrM'], {'chrM':fai_to_len("${this_fasta_shifted}.fai")}, mt_contigs=['chrM'])
shifted_target.add_sequence("${this_fasta_shifted}", "${this_fasta_shifted}.fai")
target.add_liftover("${this_chain_fwd_shifted}", shifted_target)

mt_new = hl.import_vcf("${this_filt_vcf}", reference_genome='mtGRCh38').select_entries()
check_vcf_integrity(mt_new)

mt_new_1 = mt_new.select_rows()
mt_lifted_target = apply_conversion(mt_new_1, "target_self")
check_vcf_integrity(mt_lifted_target)
hl.export_vcf(mt_lifted_target, "${this_vcf_bgz}", tabix=True)

mt_new_2 = mt_new.select_rows('filters')
this_metadata = hl.get_vcf_metadata("${this_filt_vcf}")
this_metadata = {'filter': this_metadata['filter']}
mt_lifted_target_withfilter = apply_conversion(mt_new_2, "target_self")
check_vcf_integrity(mt_lifted_target_withfilter)
hl.export_vcf(mt_lifted_target_withfilter, "${this_vcf_filters_bgz}", tabix=True, metadata=this_metadata)

mt_lifted_shifted_target = apply_conversion(mt_lifted_target, "target_self_shifted", skip_flip=True)
check_vcf_integrity(mt_lifted_shifted_target)
hl.export_vcf(mt_lifted_shifted_target, "${this_vcf_shifted_bgz}", tabix=True)
CODE`
2026-02-04 20:27:10 cromwell-system-akka.dispatchers.backend-dispatcher-158 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(83858836)ProduceSelfReferenceFiles.ProduceSelfReference:NA:1]: Asking singleton actor to submit a job: job-83858836-produceselfreferencefilesproduceselfref-1-2c4ff9e7
2026-02-04 20:27:13 cromwell-system-akka.dispatchers.backend-dispatcher-143 INFO  - Run operation succeeded projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-83858836-produceselfreferencefilesproduceselfref-1-2c4ff9e7
2026-02-04 20:27:13 cromwell-system-akka.dispatchers.backend-dispatcher-143 INFO  - A job was submitted successfully: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-83858836-produceselfreferencefilesproduceselfref-1-2c4ff9e7
2026-02-04 20:27:18 cromwell-system-akka.dispatchers.backend-dispatcher-142 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(83858836)ProduceSelfReferenceFiles.ProduceSelfReference:NA:1]: job id: projects/terra-vpc-sc-17dda7e1/locations/us-central1/jobs/job-83858836-produceselfreferencefilesproduceselfref-1-2c4ff9e7
2026-02-04 20:27:20 cromwell-system-akka.dispatchers.backend-dispatcher-114 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(83858836)ProduceSelfReferenceFiles.ProduceSelfReference:NA:1]: Status change from - to Initializing
2026-02-04 20:30:32 cromwell-system-akka.dispatchers.backend-dispatcher-145 INFO  - GcpBatchAsyncBackendJobExecutionActor [UUID(83858836)ProduceSelfReferenceFiles.ProduceSelfReference:NA:1]: Status change from Initializing to Failed
2026-02-04 20:30:44 cromwell-system-akka.dispatchers.engine-dispatcher-8 INFO  - WorkflowManagerActor: Workflow b91103f9-dfd9-4179-aa3d-eadc298ca0c9 failed (during ExecutingWorkflowState): java.lang.Exception: Task ProduceSelfReferenceFiles.ProduceSelfReference:NA:1 failed. The job was stopped before the command finished. GCP Batch task exited with Success(0). 
	at cromwell.backend.google.batch.actors.GcpBatchAsyncBackendJobExecutionActor$.StandardException(GcpBatchAsyncBackendJobExecutionActor.scala:83)
	at cromwell.backend.google.batch.actors.GcpBatchAsyncBackendJobExecutionActor.handleFailedRunStatus$1(GcpBatchAsyncBackendJobExecutionActor.scala:1152)
	at cromwell.backend.google.batch.actors.GcpBatchAsyncBackendJobExecutionActor.$anonfun$handleExecutionFailure$1(GcpBatchAsyncBackendJobExecutionActor.scala:1168)
	at scala.util.Try$.apply(Try.scala:210)
	at cromwell.backend.google.batch.actors.GcpBatchAsyncBackendJobExecutionActor.handleExecutionFailure(GcpBatchAsyncBackendJobExecutionActor.scala:1160)
	at cromwell.backend.google.batch.actors.GcpBatchAsyncBackendJobExecutionActor.handleExecutionFailure(GcpBatchAsyncBackendJobExecutionActor.scala:144)
	at cromwell.backend.standard.StandardAsyncExecutionActor$$anonfun$handleExecutionResult$11.applyOrElse(StandardAsyncExecutionActor.scala:1506)
	at cromwell.backend.standard.StandardAsyncExecutionActor$$anonfun$handleExecutionResult$11.applyOrElse(StandardAsyncExecutionActor.scala:1503)
	at scala.concurrent.impl.Promise$Transformation.run(Promise.scala:490)
	at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:41)
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(ForkJoinExecutorConfigurator.scala:49)
	at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
	at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)

2026-02-04 20:30:48 cromwell-system-akka.dispatchers.engine-dispatcher-8 INFO  - WorkflowManagerActor: Workflow actor for b91103f9-dfd9-4179-aa3d-eadc298ca0c9 completed with status 'Failed'. The workflow will be removed from the workflow store.
